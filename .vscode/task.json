{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Start dev server (*)",
            "type": "shell",
            "command": "symfony server:start",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        
        // Tâches à faire une fois à la récupération du projet
        {
            "label": "Install All",
            "dependsOn": [
                "Install Composer",
                "Install Yarn",
                "Build All",
            ],
            "dependsOrder": "sequence",
            "problemMatcher": [],
        },
        {
            "label": "Install Composer",
            "type": "shell",
            "command": "composer install",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        {
            "label": "Install Yarn",
            "type": "shell",
            "command": "yarn install",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        
        // Tâches à faire une fois le développement terminé pour tester le site
        // (pour Yarn, il existe "Yarn Watch" qui régénère les fichiers à la volée)
        {
            "label": "Build All",
            "dependsOn": [
                "Build FOS Routing Dump",
                "Build Yarn Dev",
            ],
            "dependsOrder": "sequence",
            "problemMatcher": [],
        },
        {
            "label": "Build FOS Routing Dump",
            "type": "shell",
            "command": "php bin/console fos:js-routing:dump --format=json --target public/js/fos_js_routes.json",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
            "group": "build"
        },
        {
            "label": "Build Yarn Dev",
            "type": "shell",
            "command": "yarn encore dev",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
            "group": "build"
        },
        
        // Tâche à faire pendant le développement pour regénérer les fichiers d'asset à la volée
        {
            "label": "Build Yarn Watch",
            "type": "shell",
            "command": "yarn encore dev --watch",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": []
        },
        
        // Nettoyage du cache
        {
            "label": "Clear Cache Dev",
            "type": "shell",
            "command": "php bin/console cache:clear",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        {
            "label": "Clear Cache Prod",
            "type": "shell",
            "command": "php bin/console cache:clear --env=prod",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        
        // Lancement des tests
        {
            "label": "Tests",
            "type": "shell",
            "command": "./bin/phpunit tests",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        {
            "label": "Tests with Reset",
            "type": "shell",
            "command": ". ../tests/reset_test_base.sh && ./bin/phpunit tests && psql -U postgres back_office_test_master -c 'DROP DATABASE back_office_test;'",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        
        // Analyse du code
        {
            "label": "Sonar Scanner",
            "type": "shell",
            "command": "sonar-scanner",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": [],
        },
        {
            "label": "Tests avant Sonar Scanner",
            "type": "shell",
            "command": "./bin/phpunit --log-junit var/log/test-report.xml --coverage-clover var/log/test-coverage.xml",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        
        // Mise à jour des dépendances (relancer les tests après...)
        {
            "label": "Composer Update",
            "type": "shell",
            "command": "composer update",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
        {
            "label": "Yarn Upgrade",
            "type": "shell",
            "command": "yarn upgrade",
            "options": {
                "cwd": "${workspaceFolder}/symfony"
            },
            "problemMatcher": [],
        },
    ]
}
